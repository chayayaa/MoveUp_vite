import{f,u as I,r as A,o as l,c as n,b as t,a as u,w,e as U,y as S,z as N,A as j,g as D,s as F,F as g,i as C,x as z,m as r,v as c,B as E,t as h}from"./index-BzdrLKoH.js";import{S as $}from"./sweetalert2.all-jWYCDLvl.js";import{_ as O,i as R,j as q,k as G,u as H,l as J}from"./_plugin-vue_export-helper-B5H5ynSv.js";import{F as K}from"./FooterComponent-DM5Kke19.js";import{u as Q,_ as W}from"./Pagination-CbBV4vlb.js";const V=m=>(N("data-v-02349226"),m=m(),j(),m),X={class:"navbar navbar-expand-lg navbar-dark position-absolute top-0 start-50 translate-middle-x container",style:{width:"100%"}},Y={class:"container-fluid mx-5 navbar-brand"},Z=V(()=>t("h2",null,"後台管理頁面",-1)),tt=V(()=>t("button",{class:"navbar-toggler",type:"button","data-bs-toggle":"collapse","data-bs-target":"#navbarSupportedContent","aria-controls":"navbarSupportedContent","aria-expanded":"false","aria-label":"Toggle navigation"},[t("span",{class:"navbar-toggler-icon"})],-1)),et={class:"collapse navbar-collapse justify-content-lg-end",id:"navbarSupportedContent",style:{"margin-right":"auto"}},ot={class:"navbar-nav mb-2 mb-lg-0"},st={class:"nav-item"},at={class:"nav-item"},lt={__name:"AdminNavComponent",setup(m){f(!1);const P=I();function d(){S.defaults.headers.common.Authorization="",P.push("/login")}return(_,b)=>{const i=A("router-link");return l(),n("nav",X,[t("div",Y,[u(i,{to:"/",class:"navbar-brand fs-1 fw-bold demo text-white",id:"fp"},{default:w(()=>[U("動起來~ ")]),_:1}),Z,tt,t("div",et,[t("ul",ot,[t("li",st,[u(i,{to:"/",class:"nav-link text-color-1","aria-current":"page"},{default:w(()=>[U("首頁")]),_:1})]),t("li",at,[u(i,{to:"/adminProducts",class:"nav-link"},{default:w(()=>[U("課程管理")]),_:1})]),t("li",null,[t("button",{type:"button",class:"btn btn-outline-primary",onClick:d},"登出")])])])])])}}},nt=O(lt,[["__scopeId","data-v-02349226"]]),it={class:"mt-5 pt-5 about"},rt={class:"container main-content pt-5 px-5"},dt={class:"text-end"},ct={class:"table mt-4 text-center"},ut=t("thead",null,[t("tr",null,[t("th",{width:"120"}," 分類 "),t("th",null,"課程名稱"),t("th",{width:"120"}," 原價 "),t("th",{width:"120"}," 售價 "),t("th",{width:"100"}," 是否啟用 "),t("th",{width:"120"})])],-1),pt={key:0,class:"text-success fw-bolder"},mt={key:1},_t={class:"btn-group"},vt=["onClick"],bt=["onClick"],gt={class:"modal fade",id:"productModal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},ht={class:"modal-dialog modal-xl"},ft={class:"modal-content"},yt={class:"modal-header bg-dark text-white"},xt={class:"modal-title",id:"exampleModalLabel"},kt={key:0},wt={key:1},Ut=t("button",{type:"button",class:"btn-close btn-close-white","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),Pt={class:"modal-body mx-3"},Ct={class:"row"},$t={class:"col-sm-4"},It={class:"mb-3"},At=t("label",{for:"imageUrl",class:"form-label"},"主要圖片",-1),St=["src"],Vt=t("h3",{class:"mb-3"},"多圖新增",-1),Mt={key:0},Lt=["onUpdate:modelValue"],Tt=["src"],Bt={key:0},Nt={key:1},jt={key:1},Dt={class:"col-sm-8"},Ft={class:"form-group"},zt=t("label",{for:"title"},"標題",-1),Et={class:"row"},Ot={class:"form-group col-md-6"},Rt=t("label",{for:"category"},"分類",-1),qt={class:"form-group col-md-6"},Gt=t("label",{for:"price"},"單位",-1),Ht={class:"row"},Jt={class:"form-group col-md-6"},Kt=t("label",{for:"origin_price"},"原價",-1),Qt={class:"form-group col-md-6"},Wt=t("label",{for:"price"},"售價",-1),Xt=t("hr",null,null,-1),Yt={class:"form-group"},Zt=t("label",{for:"description"},"課程描述",-1),te={class:"form-group"},ee=t("label",{for:"content"},"說明內容",-1),oe={class:"mb-3"},se={class:"form-check"},ae=t("label",{class:"form-check-label",for:"is_enabled"},"是否啟用",-1),le={class:"modal-footer d-flex justify-content-center mx-3"},ne=t("button",{type:"button",class:"btn btn-outline-secondary btn-lg","data-bs-dismiss":"modal"},"取消",-1),pe={__name:"Products",setup(m,{emit:P}){const d=f(!1),_=I(),b=f([]),i=Q(),o=f({imageUrl:[]});D(async()=>{await v()});async function v(){await x(),d.value=!0;try{const a=await R();b.value=Object.values(a.data.products);const e=Math.ceil(b.value.length/i.itemsPerPage);i.totalPages=e,i.setCurrentPage(1),d.value=!1}catch(a){console.log(a)}}const M=F(()=>{const a=(i.currentPage-1)*i.itemsPerPage,e=a+i.itemsPerPage;return b.value.slice(a,e)});async function y(a,e){d.value=!0,await x(),a==="new"?o.value={imageUrl:[]}:a==="edit"?o.value={...e}:a==="delete"&&(this.isLoading=!0,await G(e.id),await v()),d.value=!1}async function L(a){try{await x(),a.id?(await H(a)).data.success?await v():$.fire({title:"失敗!",text:"課程編輯失敗",icon:"error"}):(await J(a)).data.success?await v():$.fire({title:"失敗!",text:"課程新增失敗",icon:"error"})}catch(e){console.log(e)}}function T(){o.value.imagesUrl=[],o.value.imagesUrl.push("")}async function x(){d.value=!0;const a=localStorage.getItem("token"),e=localStorage.getItem("tokenExpiration");try{a&&e?new Date().getTime()<e?(S.defaults.headers.common.Authorization=`Bearer ${a}`,(await q()).data.success||_.push("/login")):(localStorage.removeItem("token"),localStorage.removeItem("tokenExpiration"),_.push("/login")):_.push("/login")}catch{_.push("/login")}finally{d.value=!1}}return(a,e)=>{const k=A("Loading");return l(),n(g,null,[u(nt),t("div",null,[u(k,{active:d.value},null,8,["active"])]),t("div",it,[t("div",rt,[t("div",dt,[t("button",{type:"button",class:"btn btn-success",onClick:e[0]||(e[0]=s=>y("new")),"data-bs-toggle":"modal","data-bs-target":"#productModal"}," 建立新的課程 ")]),t("table",ct,[ut,t("tbody",null,[(l(!0),n(g,null,C(M.value,s=>(l(),n("tr",{key:s.id},[t("td",null,h(s.category),1),t("td",null,h(s.title),1),t("td",null,h(s.origin_price),1),t("td",null,h(s.price),1),t("td",null,[s.is_enabled?(l(),n("span",pt,"啟用")):(l(),n("span",mt,"未啟用"))]),t("td",null,[t("div",_t,[t("button",{type:"button",class:"btn btn-outline-primary btn-sm","data-bs-toggle":"modal","data-bs-target":"#productModal",onClick:p=>y("edit",s)}," 編輯 ",8,vt),t("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:p=>y("delete",s)}," 刪除 ",8,bt)])])]))),128))])]),u(W,{pages:z(i),"get-products":v},null,8,["pages"])]),t("div",gt,[t("div",ht,[t("div",ft,[t("div",yt,[t("h5",xt,[o.value.id?(l(),n("span",kt,"編輯課程 :")):(l(),n("span",wt,"新增課程"))]),Ut]),t("div",Pt,[t("div",Ct,[t("div",$t,[t("div",It,[At,r(t("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>o.value.imageUrl=s),type:"text",class:"form-control mb-2",placeholder:"請輸入圖片連結"},null,512),[[c,o.value.imageUrl]]),t("img",{class:"img-fluid",src:o.value.imageUrl},null,8,St)]),Vt,Array.isArray(o.value.imagesUrl)?(l(),n("div",Mt,[(l(!0),n(g,null,C(o.value.imagesUrl,(s,p)=>(l(),n(g,{key:p},[r(t("input",{"onUpdate:modelValue":B=>o.value.imagesUrl[p]=B,type:"text",class:"form-control"},null,8,Lt),[[c,o.value.imagesUrl[p]]]),t("img",{src:o.value.imagesUrl[p],alt:"",class:"img-fluid mb-2 mt-2"},null,8,Tt)],64))),128)),!o.value.imagesUrl.length||o.value.imagesUrl[o.value.imagesUrl.length-1]?(l(),n("div",Bt,[t("button",{class:"btn btn-outline-primary btn-sm d-block w-100",onClick:e[2]||(e[2]=s=>o.value.imagesUrl.push(""))}," 新增圖片 ")])):(l(),n("div",Nt,[t("button",{class:"btn btn-outline-danger btn-sm d-block w-100",onClick:e[3]||(e[3]=s=>o.value.imagesUrl.pop())}," 刪除圖片 ")]))])):(l(),n("div",jt,[t("button",{class:"btn btn-outline-primary btn-sm d-block w-100",onClick:T}," 新增圖片 ")]))]),t("div",Dt,[t("div",Ft,[zt,r(t("input",{id:"title","onUpdate:modelValue":e[4]||(e[4]=s=>o.value.title=s),type:"text",class:"form-control",placeholder:"請輸入標題"},null,512),[[c,o.value.title]])]),t("div",Et,[t("div",Ot,[Rt,r(t("input",{id:"category","onUpdate:modelValue":e[5]||(e[5]=s=>o.value.category=s),type:"text",class:"form-control",placeholder:"請輸入分類"},null,512),[[c,o.value.category]])]),t("div",qt,[Gt,r(t("input",{id:"unit","onUpdate:modelValue":e[6]||(e[6]=s=>o.value.unit=s),type:"unit",class:"form-control",placeholder:"請輸入單位"},null,512),[[c,o.value.unit]])])]),t("div",Ht,[t("div",Jt,[Kt,r(t("input",{id:"origin_price","onUpdate:modelValue":e[7]||(e[7]=s=>o.value.origin_price=s),type:"number",class:"form-control",placeholder:"請輸入原價"},null,512),[[c,o.value.origin_price]])]),t("div",Qt,[Wt,r(t("input",{id:"price","onUpdate:modelValue":e[8]||(e[8]=s=>o.value.price=s),type:"number",class:"form-control",placeholder:"請輸入售價"},null,512),[[c,o.value.price]])])]),Xt,t("div",Yt,[Zt,r(t("textarea",{id:"description","onUpdate:modelValue":e[9]||(e[9]=s=>o.value.description=s),type:"text",class:"form-control",placeholder:"請輸入課程描述"},`\r
        `,512),[[c,o.value.description]])]),t("div",te,[ee,r(t("textarea",{id:"description","onUpdate:modelValue":e[10]||(e[10]=s=>o.value.content=s),type:"text",class:"form-control",placeholder:"請輸入說明內容"},`\r
        `,512),[[c,o.value.content]])]),t("div",oe,[t("div",se,[r(t("input",{id:"is_enabled","onUpdate:modelValue":e[11]||(e[11]=s=>o.value.is_enabled=s),class:"form-check-input",type:"checkbox","true-value":1,"false-value":0},null,512),[[E,o.value.is_enabled]]),ae])])])])]),t("div",le,[t("button",{type:"button",class:"btn btn-success btn-lg",onClick:e[12]||(e[12]=s=>L(o.value)),"data-bs-dismiss":"modal"},"確認"),ne])])])])]),u(K)],64)}}};export{pe as default};
